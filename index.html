<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>La dévalidothèque en ligne</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding:20px; background:#f7f7fb; color:#111; }
    .table-wrap { max-width:1100px; margin:0 auto; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(16,24,40,0.06); overflow:hidden; }
    table { width:100%; border-collapse:collapse; table-layout:fixed; }
    th, td { padding:10px 12px; text-align:left; border-bottom:1px solid #eee; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; vertical-align:middle; }
    thead th { background:#fafafa; cursor:pointer; user-select:none; position:relative; font-weight:600; }
    .sort-indicator { font-size:12px; margin-left:8px; color:#666; }
    thead th.asc .sort-indicator::after  { content: "▲"; display:inline-block; margin-left:6px; }
    thead th.desc .sort-indicator::after { content: "▼"; display:inline-block; margin-left:6px; }

    /* Largeurs des colonnes */
    th.cover, td.cover { width:64px; text-align:center; }
    th.title, td.title { width:33%; }
    th.authors, td.authors { width:22%; }
    th.date, td.date { width:12%; }
    th.size, td.size { width:10%; }
    th.license, td.license { width:9%; }

    /* Miniature couverture */
    .thumb { width:48px; height:64px; object-fit:cover; border-radius:4px; display:inline-block; background:#f0f0f2; }

    @media (max-width:760px){
      table, thead, tbody, th, td, tr { display:block; }
      thead { display:none; }
      tr { margin-bottom:12px; background:#fff; border-radius:6px; box-shadow:0 1px 3px rgba(0,0,0,0.04); padding:10px; }
      td { display:flex; justify-content:space-between; padding:8px 10px; border-bottom:none; }
      td::before { content: attr(data-label); font-weight:600; color:#444; margin-right:8px; }
      .cover { text-align:left; }
    }
  </style>
</head>
<body>

<div class="table-wrap">
  <table id="booksTable" aria-describedby="table-desc">
    <caption id="table-desc" style="text-align:left;padding:12px 14px;font-weight:600;">
      Brochures
    </caption>
    <thead>
      <tr>
        <th class="cover" data-key="modified" scope="col" title="Date de modification du fichier"> </th>
        <th class="title" data-key="title" scope="col">Titre <span class="sort-indicator"></span></th>
        <th class="authors" data-key="authors" scope="col">Auteures <span class="sort-indicator"></span></th>
        <th class="pages" data-key="pages" scope="col">Nombre de pages <span class="sort-indicator"></span></th>
        <th class="date" data-key="date" scope="col">Date de parution <span class="sort-indicator"></span></th>
        <th class="size" data-key="size" scope="col">Poids <span class="sort-indicator"></span></th>
        <th class="license" data-key="license" scope="col">Licence <span class="sort-indicator"></span></th>
      </tr>
    </thead>
    <tbody>
      <!-- Exemple de lignes : note les data-modified et data-size -->
      <tr>
        <td class="cover" data-label="Couverture">
          <img class="thumb" src="cover1.jpg" alt="Couverture Le Château" />
        </td>
        <td class="title" data-label="Titre">CRIP - Compilation de textes à propos de Luttes handies</td>
        <td class="authors" data-label="Auteures">Harriet de Gouge</td>
        <td class="pages" data-label="Nombre de pages">52p</td>
        <td class="date" data-label="Date de parution">2023</td>
        <td class="size" data-label="Poids" data-size="124800">14Mo</td>
        <td class="license" data-label="Licence">CC BY-SA 4.0</td>
      </tr>

      <tr>
        <td class="cover" data-label="Couverture">
          <img class="thumb" src="cover2.jpg" alt="Couverture Zéphyr" />
        </td>
        <td class="title" data-label="Titre">Toujours mal quelque part</td>
        <td class="authors" data-label="Auteures">Harriet de Gouge</td>
        <td class="pages" data-label="Nombre de pages">44p</td>
        <td class="date" data-label="Date de parution">2024</td>
        <td class="size" data-label="Poids" data-size="2048000">8Mo</td>
        <td class="license" data-label="Licence">CC BY-NC</td>
      </tr>

    </tbody>
  </table>
</div>

<script>
(function(){
  const table = document.getElementById('booksTable');
  const tbody = table.tBodies[0];
  const headers = table.tHead.querySelectorAll('th');
  let sortState = { key: null, dir: 'asc' };

  function getRows(){ return Array.from(tbody.querySelectorAll('tr')); }

  function cellValue(row, key){
    if (key === 'modified') {
      // data-modified attendu sur la ligne (ISO) ou sur la cellule .cover (data-modified)
      const cover = row.querySelector('td.cover');
      const v = cover ? (cover.dataset.modified || cover.getAttribute('data-modified') || '') : '';
      return v.trim();
    }
    if (key === 'size') {
      const td = row.querySelector('td.size');
      const raw = td ? (td.dataset.size || td.getAttribute('data-size') || td.textContent.trim()) : '';
      return raw.toString().trim();
    }
    const td = row.querySelector('td.' + key) || row.querySelector('td.' + ({title:'title', authors:'authors', date:'date', license:'license'}[key] || ''));
    return td ? td.textContent.trim() : '';
  }

  function isISODateString(s){ return /^\d{4}-\d{2}-\d{2}/.test(s); }

  function compareRows(a,b,key,dir){
    const va = cellValue(a,key);
    const vb = cellValue(b,key);

    // modified/date: ISO dates
    if ((key === 'date' || key === 'modified') && (isISODateString(va) || isISODateString(vb))) {
      const da = va ? new Date(va) : new Date(0);
      const db = vb ? new Date(vb) : new Date(0);
      return (da - db) * (dir === 'asc' ? 1 : -1);
    }

    if (key === 'size') {
      const na = parseFloat(va.toString().replace(/[^\d.-]/g,'')) || 0;
      const nb = parseFloat(vb.toString().replace(/[^\d.-]/g,'')) || 0;
      return (na - nb) * (dir === 'asc' ? 1 : -1);
    }

    // Texte par défaut
    return va.localeCompare(vb, 'fr', { sensitivity: 'base', numeric: true }) * (dir === 'asc' ? 1 : -1);
  }

  function updateHeaderClasses(){
    headers.forEach(h => {
      h.classList.remove('asc','desc');
      const key = h.dataset.key;
      if (key === sortState.key) h.classList.add(sortState.dir);
    });
  }

  function sortBy(key){
    const rows = getRows();
    if (sortState.key === key) sortState.dir = sortState.dir === 'asc' ? 'desc' : 'asc';
    else { sortState.key = key; sortState.dir = 'asc'; }

    rows.sort((a,b) => compareRows(a,b,key,sortState.dir));
    const frag = document.createDocumentFragment();
    rows.forEach(r => frag.appendChild(r));
    tbody.appendChild(frag);
    updateHeaderClasses();
  }

  headers.forEach(h => {
    h.addEventListener('click', () => sortBy(h.dataset.key));
    h.tabIndex = 0;
    h.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); sortBy(h.dataset.key); }
    });
  });

  // Tri initial par date de modification (modified) si présent, sinon par titre
  sortBy('modified');
})();
</script>
